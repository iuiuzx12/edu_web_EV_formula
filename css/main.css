:root {
    /* ========================== */
    /*      Color Palette (New)   */
    /* ========================== */

    /* Primary Colors (Navy Blue Focus) */
    --primary-navy-dark: #001f3f; /* Darker Navy for backgrounds in dark mode */
    --primary-navy-main: #002366; /* Main Navy Blue - Formal and Trustworthy */
    --primary-navy-light: #19376D; /* Lighter Navy for accents or light mode backgrounds */
    --primary-navy-very-light: #E0EFFF; /* Very light blue for subtle highlights */

    /* Secondary Colors (Grays) */
    --secondary-gray-lightest: #F5F5F5; /* Lightest gray for secondary backgrounds */
    --secondary-gray-light: #EAEAEA;   /* Light gray for borders or subtle divisions */
    --secondary-gray-medium: #D3D3D3;  /* Medium gray for less prominent borders */
    --secondary-gray-dark: #707070;    /* Dark gray for secondary text */
    --secondary-gray-darkest: #4A4A4A; /* Darkest gray for sub-headings or less important text */

    /* Accent Colors */
    --accent-blue-cta: #007BFF;      /* Bright blue for Call-to-Actions */
    --accent-green-success: #006400; /* Dark green for success, growth (use sparingly) */
    /* Consider an alternative accent if green clashes */
    --accent-blue-highlight: #60a5fa; /* Existing highlight blue, can be kept or refined */


    /* Text Colors */
    --text-color-main: #212529;       /* Dark gray (almost black) for main content - Improved Readability */
    --text-color-secondary: #495057;  /* Slightly lighter gray for secondary content */
    --text-color-headings: #19376D;  /* Navy for headings to match primary color */
    --text-color-on-dark-bg: #E2E8F0; /* Light gray/white for text on dark backgrounds */
    --text-color-on-navy-bg: #FFFFFF; /* White text on navy backgrounds */
    --text-color-muted: var(--secondary-gray-dark); /* Muted text */


    /* Dark Theme Colors (Using New Palette) */
    --dark-bg-start: var(--primary-navy-dark);
    --dark-bg-end: #001a33; /* Slightly different shade of dark navy */
    --dark-text-primary: var(--text-color-on-dark-bg);
    --dark-text-headings: var(--primary-navy-very-light); /* Light blue for headings on dark bg */
    --dark-text-secondary: var(--secondary-gray-medium); /* Lighter gray for secondary text on dark */
    --dark-text-muted: var(--secondary-gray-dark);

    --dark-card-bg-start: rgba(25, 55, 109, 0.7); /* Semi-transparent Navy (primary-navy-light) */
    --dark-card-bg-end: rgba(25, 55, 109, 0.9);
    --dark-card-border: rgba(100, 116, 139, 0.3); /* Keeping a subtle border */
    --dark-interactive-card-bg-start: rgba(25, 55, 109, 0.9);
    --dark-interactive-card-bg-end: rgba(0, 31, 63, 0.9); /* Darker navy for interactive elements */

    --dark-code-bg-start: var(--primary-navy-dark);
    --dark-code-bg-end: #001a33;
    --dark-code-text: var(--text-color-on-dark-bg);
    --dark-code-border: rgba(100, 116, 139, 0.4);
    --dark-code-keyword: var(--accent-blue-highlight);
    --dark-code-function: #a78bfa; /* Keeping purple for functions for now, can be reviewed */
    --dark-code-comment: var(--secondary-gray-dark);
    --dark-code-string: #a3e635; /* Keeping green for strings for now */
    --dark-code-placeholder: #fbbf24; /* Keeping amber for placeholders */
    --dark-highlight-bg: rgba(96, 165, 250, 0.15); /* accent-blue-highlight with more opacity */
    --dark-highlight-border: var(--accent-blue-highlight);

    --dark-button-primary-bg-start: var(--accent-blue-cta);
    --dark-button-primary-bg-end: #0062CC; /* Slightly darker CTA blue for gradient */
    --dark-button-text: var(--text-color-on-navy-bg);
    --dark-tab-bg: rgba(25, 55, 109, 0.7);
    --dark-tab-border: var(--primary-navy-light);
    --dark-tab-hover-bg: rgba(25, 55, 109, 0.9);
    --dark-input-bg: rgba(0, 31, 63, 0.5);
    --dark-input-border: var(--primary-navy-light);
    --dark-input-focus-border: var(--accent-blue-cta);
    --dark-input-focus-shadow: rgba(0, 123, 255, 0.3);

    --dark-nav-link-active-bg-start: rgba(0, 123, 255, 0.2); /* accent-blue-cta transparent */
    --dark-nav-link-active-bg-end: rgba(0, 98, 204, 0.3);
    --dark-nav-link-active-border: var(--accent-blue-cta);
    
    --dark-modal-bg-start: var(--primary-navy-main);
    --dark-modal-bg-end: var(--primary-navy-dark);

    /* Light Theme Colors (Using New Palette) */
    --light-bg-start: var(--secondary-gray-lightest); /* Clean, light gray background */
    --light-bg-end: #FFFFFF;                          /* White for gradient end */
    --light-text-primary: var(--text-color-main);
    --light-text-headings: var(--text-color-headings); /* Navy for headings */
    --light-text-primary-actual: var(--text-color-main);
    --light-text-secondary: var(--text-color-secondary);
    --light-text-muted: var(--secondary-gray-dark);
    --light-text-subtle: var(--secondary-gray-darkest);

    --light-card-bg-start: #FFFFFF; /* White card background */
    --light-card-bg-end: var(--secondary-gray-lightest); /* Very light gray for subtle gradient */
    --light-card-border: var(--secondary-gray-medium); /* Medium gray border */
    --light-interactive-card-bg-start: #FFFFFF;
    --light-interactive-card-bg-end: var(--secondary-gray-lightest);
    --light-interactive-card-border: var(--secondary-gray-light);

    --light-code-bg: var(--secondary-gray-lightest);
    --light-code-text: var(--text-color-main);
    --light-code-border: var(--secondary-gray-medium);
    --light-code-keyword: #0056b3; /* Darker blue for keywords */
    --light-code-function: #581c87; /* Darker purple */
    --light-code-comment: var(--secondary-gray-dark);
    --light-code-string: #004d00; /* Darker green */
    --light-code-placeholder: #7f5f00; /* Darker amber */
    
    --light-button-primary-bg-start: var(--accent-blue-cta);
    --light-button-primary-bg-end: #0056b3; /* Darker blue for gradient */
    /* --light-button-primary-bg-start: var(--accent-green-success); /* Alternative: Green CTA */
    /* --light-button-primary-bg-end: #004d00; /* Darker Green CTA */
    --light-tab-bg: var(--secondary-gray-lightest);
    --light-tab-border: var(--secondary-gray-medium);
    --light-input-bg: #FFFFFF;
    --light-input-border: var(--secondary-gray-medium);
    --light-input-focus-border: var(--accent-blue-cta);
    --light-input-focus-shadow: rgba(0, 123, 255, 0.2);

    --light-nav-link-color: var(--secondary-gray-darkest);
    --light-nav-link-hover-color: var(--primary-navy-main);
    --light-nav-link-hover-bg: var(--primary-navy-very-light);
    --light-nav-link-active-bg-start: rgba(0, 123, 255, 0.1); /* accent-blue-cta transparent */
    --light-nav-link-active-bg-end: rgba(0, 98, 204, 0.15);
    --light-nav-link-active-color: var(--accent-blue-cta);
    --light-nav-link-active-border: var(--accent-blue-cta);
    --light-section-icon-bg-start: var(--primary-navy-main);
    --light-section-icon-bg-end: var(--primary-navy-light); 
    
    --light-modal-bg-start: var(--secondary-gray-lightest);
    --light-modal-bg-end: #FFFFFF;

    /* ========================== */
    /* Theme-Agnostic Color Palette (Legacy - Will be phased out or integrated) */
    /* ========================== */
    /* These colors are used directly or as base for theme-specific variables. */
    --color-white: #FFFFFF; /* Explicit white */
    --color-red-error: #dc3545; /* Bootstrap-like error red */
    --color-red-error-shadow: rgba(220, 53, 69, 0.3);
    --color-red-darker: #b02a37;
    --color-red-light-bg: #f8d7da;
    --color-red-light-border: #f5c6cb;
    --color-red-active-border: #f1aeb5;

    --color-blue-primary: var(--accent-blue-cta); /* Referencing new palette */
    --color-blue-darker: #0056b3; /* Darker blue for general use if needed */
    --color-blue-darkest: #004085;
    --color-blue-light-bg: #cce5ff;
    --color-blue-light-border: #b8daff;
    --color-blue-active-border: var(--accent-blue-highlight); /* Referencing new palette */
    
    --color-purple-primary: #8b5cf6; /* Kept for now, review if needed */
    --color-purple-darker: #7c3aed;
    --color-purple-darkest: #6d28d9;

    --color-amber-primary: #ffc107; /* Bootstrap-like warning amber */
    --color-amber-darker: #cc9a06;
    --color-amber-darkest: #997404;
    --color-amber-light-bg: #fff3cd;
    --color-amber-light-border: #ffeeba;
    --color-amber-inline-code-bg: #fff9e6;
    --color-amber-inline-code-text: #856404;

    --color-green-primary: #28a745; /* Bootstrap-like success green */
    --color-green-darker: #1e7e34;
    --color-green-darkest: #155724;
    --color-green-decision: var(--accent-green-success); /* Referencing new palette */

    /* ========================== */
    /*      Fonts & Sizing        */
    /* ========================== */
    /* Fonts */
    --font-primary: 'Lato', 'Sarabun', sans-serif; /* Changed to Lato, Sarabun as fallback */
    --font-code: 'Fira Code', 'Courier New', monospace;

    /* Sizes & Spacing */
    --border-radius-sm: 0.5rem; /* 8px */
    --border-radius-md: 0.75rem; /* 12px */
    --border-radius-lg: 1rem; /* 16px */
    --padding-sm: 0.75rem; /* 12px */
    --padding-md: 1.5rem; /* 24px */
    --padding-lg: 2rem; /* 32px */
    --padding-xl: 2.5rem; /* 40px */

    /* Transitions */
    --transition-bg-color: background-color 0.3s ease, color 0.3s ease;
    --transition-transform-shadow: transform 0.3s ease, box-shadow 0.3s ease;
    --transition-all-fast: all 0.2s ease;

    /* ===================================== */
    /* Theme-Specific Variables (Dark Default) */
    /* ===================================== */
    /* These variables switch values based on the active theme (dark/light). */
    /* They are defined first for Dark mode, then overridden in body.light-mode. */
    --bg-gradient: linear-gradient(135deg, var(--dark-bg-start) 0%, var(--dark-bg-end) 100%);
    --text-primary: var(--dark-text-primary);
    --text-headings: var(--dark-text-headings);
    --text-secondary: var(--dark-text-secondary);
    --text-muted: var(--dark-text-muted);
    --text-subtle: var(--dark-text-muted); /* Keeping subtle for now, maps to muted in dark */

    --card-bg-gradient: linear-gradient(145deg, var(--dark-card-bg-start) 0%, var(--dark-card-bg-end) 100%);
    --card-border: var(--dark-card-border);
    --interactive-card-bg-gradient: linear-gradient(145deg, var(--dark-interactive-card-bg-start) 0%, var(--dark-interactive-card-bg-end) 100%);
    --interactive-card-border: var(--dark-card-border); /* Can be a different gray if needed */
    
    --code-bg-gradient: linear-gradient(145deg, var(--dark-code-bg-start) 0%, var(--dark-code-bg-end) 100%);
    --code-text-color: var(--dark-code-text);
    --code-border-color: var(--dark-code-border);
    --code-keyword-color: var(--dark-code-keyword);
    --code-function-color: var(--dark-code-function);
    --code-comment-color: var(--dark-code-comment);
    --code-string-color: var(--dark-code-string);
    --code-placeholder-color: var(--dark-code-placeholder);
    --highlight-bg-color: var(--dark-highlight-bg);
    --highlight-border-color: var(--dark-highlight-border);

    --button-primary-bg-gradient: linear-gradient(90deg, var(--dark-button-primary-bg-start) 0%, var(--dark-button-primary-bg-end) 100%);
    --button-text-color: var(--dark-button-text); /* Should be white or very light gray */
    --tab-bg-color: var(--dark-tab-bg);
    --tab-border-color: var(--dark-tab-border);
    --tab-hover-bg-color: var(--dark-tab-hover-bg);
    --input-bg-color: var(--dark-input-bg);
    --input-border-color: var(--dark-input-border);
    --input-focus-border-color: var(--dark-input-focus-border);
    --input-focus-shadow-color: var(--dark-input-focus-shadow);

    --nav-link-color: var(--dark-text-secondary);
    --nav-link-hover-color: var(--dark-text-headings);
    --nav-link-hover-bg: var(--dark-tab-hover-bg); /* Using tab hover for consistency */
    --nav-link-active-bg-gradient: linear-gradient(90deg, var(--dark-nav-link-active-bg-start) 0%, var(--dark-nav-link-active-bg-end) 100%);
    --nav-link-active-color: var(--dark-text-headings);
    --nav-link-active-border-color: var(--dark-nav-link-active-border);
    --section-icon-bg-gradient: linear-gradient(135deg, var(--primary-navy-main) 0%, var(--primary-navy-light) 100%); /* Updated Icon BG */
    --progress-bar-bg-gradient: linear-gradient(90deg, var(--accent-blue-cta) 0%, var(--accent-blue-highlight) 100%); /* Updated Progress Bar */
    
    --modal-bg-gradient: linear-gradient(145deg, var(--dark-modal-bg-start) 0%, var(--dark-modal-bg-end) 100%);
    --modal-border-color: var(--dark-card-border); /* Consistent with card border */

    /* Updated box shadows for better consistency and subtlety */
    --card-box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.2), 0 6px 10px -6px rgba(0, 0, 0, 0.15);
    --card-hover-box-shadow: 0 16px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -5px rgba(0, 0, 0, 0.1);
    --interactive-card-box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
    --button-primary-box-shadow: 0 4px 6px rgba(0, 123, 255, 0.25);
    --button-primary-hover-box-shadow: 0 6px 8px rgba(0, 123, 255, 0.35);
    --floating-btn-box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
    --floating-btn-hover-box-shadow: 0 8px 15px rgba(0, 0, 0, 0.35);
    --code-block-box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
}

/* ===================================== */
/*      Light Mode Variable Overrides    */
/* ===================================== */
/* This block redefines the theme-specific variables for when the 'light-mode' 
   class is applied to the body. These variables are then used throughout the
   stylesheet to style elements for the light theme. */
body.light-mode {
    --bg-gradient: linear-gradient(135deg, var(--light-bg-start) 0%, var(--light-bg-end) 100%);
    --text-primary: var(--light-text-primary-actual); /* This now refers to --text-color-main */
    --text-headings: var(--light-text-headings);    /* This now refers to --text-color-headings (navy) */
    --text-secondary: var(--light-text-secondary);  /* This now refers to --text-color-secondary */
    --text-muted: var(--light-text-muted);        /* This now refers to --secondary-gray-dark */
    --text-subtle: var(--light-text-subtle);      /* This now refers to --secondary-gray-darkest */

    --card-bg-gradient: linear-gradient(145deg, var(--light-card-bg-start) 0%, var(--light-card-bg-end) 100%);
    --card-border: var(--light-card-border);
    --interactive-card-bg-gradient: linear-gradient(145deg, var(--light-interactive-card-bg-start) 0%, var(--light-interactive-card-bg-end) 100%);
    --interactive-card-border: var(--light-interactive-card-border);

    --code-bg-gradient: var(--light-code-bg); /* This is now --secondary-gray-lightest */
    --code-text-color: var(--light-code-text);
    --code-border-color: var(--light-code-border);
    --code-keyword-color: var(--light-code-keyword);
    --code-function-color: var(--light-code-function);
    --code-comment-color: var(--light-code-comment);
    --code-string-color: var(--light-code-string);
    --code-placeholder-color: var(--light-code-placeholder);
    
    --button-primary-bg-gradient: linear-gradient(90deg, var(--light-button-primary-bg-start) 0%, var(--light-button-primary-bg-end) 100%);
    /* Button text color will inherit or be set specifically on the button class if needed */
    --tab-bg-color: var(--light-tab-bg);
    --tab-border-color: var(--light-tab-border);
    --tab-hover-bg-color: var(--primary-navy-very-light); /* Using very light blue for hover */
    --input-bg-color: var(--light-input-bg);
    --input-border-color: var(--light-input-border);
    --input-focus-border-color: var(--light-input-focus-border);
    --input-focus-shadow-color: var(--light-input-focus-shadow);

    --nav-link-color: var(--light-nav-link-color);
    --nav-link-hover-color: var(--light-nav-link-hover-color);
    --nav-link-hover-bg: var(--light-nav-link-hover-bg);
    --nav-link-active-bg-gradient: linear-gradient(90deg, var(--light-nav-link-active-bg-start) 0%, var(--light-nav-link-active-bg-end) 100%);
    --nav-link-active-color: var(--light-nav-link-active-color);
    --nav-link-active-border-color: var(--light-nav-link-active-border);
    --section-icon-bg-gradient: linear-gradient(135deg, var(--light-section-icon-bg-start) 0%, var(--light-section-icon-bg-end) 100%);
    --progress-bar-bg-gradient: linear-gradient(90deg, var(--accent-blue-cta) 0%, var(--accent-blue-highlight) 100%); /* Updated Progress Bar for Light Mode */
    
    --modal-bg-gradient: linear-gradient(145deg, var(--light-modal-bg-start) 0%, var(--light-modal-bg-end) 100%);
    --modal-border-color: var(--light-interactive-card-border); /* Consistent with interactive card border */

    /* Updated box shadows for better consistency and subtlety in Light Mode */
    --card-box-shadow: 0 6px 12px -3px rgba(25, 55, 109, 0.1), 0 4px 8px -4px rgba(25, 55, 109, 0.06); /* Softer, navy-tinted shadow */
    --card-hover-box-shadow: 0 10px 20px -5px rgba(25, 55, 109, 0.12), 0 6px 10px -5px rgba(25, 55, 109, 0.07);
    --interactive-card-box-shadow: 0 3px 6px rgba(25, 55, 109, 0.08);
    --button-primary-box-shadow: 0 4px 6px rgba(0, 123, 255, 0.2);
    --button-primary-hover-box-shadow: 0 5px 7px rgba(0, 123, 255, 0.25);
    --floating-btn-box-shadow: 0 4px 10px rgba(25, 55, 109, 0.15);
    --floating-btn-hover-box-shadow: 0 6px 12px rgba(25, 55, 109, 0.2);
    --code-block-box-shadow: 0 2px 4px rgba(25, 55, 109, 0.07);
}


/* ========================== */
/* Basic Styles & Global Reset */
/* ========================== */
* {
    /* Global transition for theme switching (background and text color) */
    transition: var(--transition-bg-color);
}

body {
    background: var(--bg-gradient); /* Themed background gradient */
    color: var(--text-primary);     /* Themed primary text color */
    font-family: var(--font-primary); /* Default font for the entire page */
    min-height: 100vh;              /* Ensure body takes at least full viewport height */
    line-height: 1.65;               /* Improved line height for readability */
    letter-spacing: 0.01em;         /* Slight letter spacing for clarity */
}

h1, h2, h3, h4, h5, h6 {
    color: var(--text-headings); /* Themed color for all heading levels */
    font-family: var(--font-primary); /* Ensure headings also use the primary font */
    font-weight: 700;            /* Bold headings for Lato (700) */
    margin-bottom: 0.75rem;      /* Consistent spacing below headings */
    line-height: 1.3;            /* Tighter line height for headings */
}

h1 { font-size: 2.5rem; } /* Example: 40px */
h2 { font-size: 2rem; }   /* Example: 32px */
h3 { font-size: 1.75rem; } /* Example: 28px */
h4 { font-size: 1.5rem; }  /* Example: 24px */
h5 { font-size: 1.25rem; } /* Example: 20px */
h6 { font-size: 1rem; }    /* Example: 16px */

p {
    margin-bottom: 1.25rem; /* Increased paragraph spacing */
    line-height: 1.75;      /* More generous line height for paragraphs */
    font-weight: 400;       /* Regular weight for Lato */
}

/* Ensure Tailwind's antialiased class doesn't override our font settings aggressively */
.antialiased {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* If Tailwind base styles are too aggressive, we might need to be more specific */
body, .text-base { /* Or other relevant Tailwind text classes */
    font-family: var(--font-primary) !important; /* Force Lato if needed */
}

/* ========================== */
/* Layout Components          */
/* ========================== */

/* General purpose card for displaying content sections */
.content-card {
    /* Box Model */
    border: 1px solid var(--secondary-gray-light); /* Updated border color */
    border-radius: var(--border-radius-md); /* Slightly smaller radius for a more formal look */
    margin-bottom: var(--padding-lg); 
    padding: var(--padding-lg);
    /* Visual */
    backdrop-filter: blur(8px); /* Slightly reduced blur */
    /* Background will be primarily white/light gray based on theme vars */
    background: var(--card-bg-gradient); /* This now uses the new light gray/white vars */
    box-shadow: var(--card-box-shadow); /* This now uses the new softer shadow vars */
    /* Animation & Transitions */
    transition: var(--transition-transform-shadow); 
}

.content-card:hover {
    box-shadow: var(--card-hover-box-shadow); /* Uses new softer hover shadow */
    transform: translateY(-4px); /* Slightly less movement on hover */
}

.interactive-card {
    /* Box Model */
    border: 1px solid var(--interactive-card-border);
    border-radius: var(--border-radius-lg);
    padding: var(--padding-md);
    /* Visual */
    background: var(--interactive-card-bg-gradient);
    box-shadow: var(--interactive-card-box-shadow);
}

/* ==================== */
/* Typography & Text    */
/* ==================== */
.gradient-header {
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    /* Ensures that text-color-headings (navy) is the dominant color in the gradient */
    background: linear-gradient(90deg, var(--text-color-headings) 70%, var(--accent-blue-cta) 100%); 
    background-clip: text;
    color: transparent;
}

.keyword-glossary {
    border-bottom: 1px dotted var(--code-keyword-color);
    color: var(--code-keyword-color); 
    cursor: pointer;
    font-weight: bold; 
    transition: var(--transition-all-fast);
    white-space: normal;
}

.keyword-glossary:hover {
    border-bottom: 1px solid #93c5fd; 
    color: #93c5fd; 
}

/* ==================== */
/* Code Display         */
/* ==================== */
.code-block {
    /* Box Model */
    border: 1px solid var(--code-border-color);
    border-radius: var(--border-radius-md);
    overflow-x: auto;
    padding: var(--padding-md);
    /* Typography */
    color: var(--code-text-color);
    font-family: var(--font-code);
    font-size: 0.95em;
    line-height: 1.6;
    white-space: pre;
    word-break: break-all;
    /* Visual */
    background: var(--code-bg-gradient);
    box-shadow: var(--code-block-box-shadow);
}

.code-keyword { 
    color: var(--code-keyword-color);
    font-weight: bold;
}

.code-function {
    color: var(--code-function-color);
}

.code-comment {
    color: var(--code-comment-color);
    font-style: italic;
}

.code-string {
    color: var(--code-string-color);
}

.code-placeholder {
    color: var(--code-placeholder-color);
    font-weight: bold;
}

.highlight-code {
    /* Positioning */
    display: block;
    /* Box Model */
    border-left: 4px solid var(--highlight-border-color);
    margin: 0 calc(-1 * var(--padding-md)); 
    padding: 0 var(--padding-md);
    /* Visual */
    background-color: var(--highlight-bg-color);
}

/* ==================== */
/* Buttons & Forms      */
/* ==================== */
.tab-button {
    /* Box Model */
    border: 1px solid var(--tab-border-color);
    padding: var(--padding-sm) 1.25rem; 
    /* Typography */
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 600;
    /* Visual */
    background-color: var(--tab-bg-color);
    /* Animation & Transitions */
    transition: var(--transition-all-fast);
    /* Misc */
    cursor: pointer;
}

.tab-button:not(.active):hover {
    background-color: var(--tab-hover-bg-color);
}

.tab-button.active {
    border-color: transparent;
    color: var(--button-text-color);
    background: var(--button-primary-bg-gradient);
}

.tab-button:first-child {
    border-bottom-left-radius: var(--border-radius-sm);
    border-top-left-radius: var(--border-radius-sm);
}

.tab-button:last-child {
    border-bottom-right-radius: var(--border-radius-sm);
    border-top-right-radius: var(--border-radius-sm);
}

.btn-primary {
    /* Box Model */
    border: none;
    border-radius: var(--border-radius-sm);
    padding: var(--padding-sm) var(--padding-md);
    /* Typography */
    color: var(--button-text-color);
    font-weight: 600;
    /* Visual */
    background: var(--button-primary-bg-gradient);
    box-shadow: var(--button-primary-box-shadow);
    /* Animation & Transitions */
    transition: var(--transition-all-fast);
    /* Misc */
    cursor: pointer;
}

.btn-primary:hover {
    box-shadow: var(--button-primary-hover-box-shadow);
    transform: translateY(-2px);
}

.input-field {
    /* Box Model */
    border: 1px solid var(--input-border-color);
    border-radius: var(--border-radius-sm);
    padding: var(--padding-sm) 1rem; 
    /* Typography */
    color: var(--text-primary);
    /* Visual */
    background: var(--input-bg-color);
    /* Animation & Transitions */
    transition: var(--transition-all-fast);
}

.input-field:focus {
    border-color: var(--input-focus-border-color);
    box-shadow: 0 0 0 3px var(--input-focus-shadow-color);
    outline: none;
}

.input-field.border-red-500 { 
    border-color: var(--color-red-error);
    box-shadow: 0 0 0 3px var(--color-red-error-shadow);
}

.loop-control-btn.active {
    border: 1px solid; 
}

#break-btn.active {
    background-color: var(--color-red-error) !important; 
    border-color: var(--color-red-active-border);
    color: var(--color-white) !important; 
}

#continue-btn.active {
    background-color: var(--color-blue-primary) !important; 
    border-color: var(--color-blue-active-border);
    color: var(--color-white) !important; 
}

/* ==================== */
/* Navigation & Modals  */
/* ==================== */
.nav-link {
    /* Positioning */
    align-items: center;
    display: flex;
    /* Box Model */
    border-radius: var(--border-radius-sm);
    margin-bottom: var(--padding-sm);
    padding: var(--padding-sm) var(--padding-md);
    /* Typography */
    color: var(--nav-link-color);
    /* Animation & Transitions */
    transition: var(--transition-all-fast);
}

.nav-link:hover {
    background: var(--nav-link-hover-bg);
    color: var(--nav-link-hover-color);
}

.nav-link.active {
    background: var(--nav-link-active-bg-gradient);
    border-left: 4px solid var(--nav-link-active-border-color);
    color: var(--nav-link-active-color);
}
body.light-mode .nav-link i { 
    color: var(--light-button-primary-bg-start) !important; 
}


.progress-bar {
    /* Positioning */
    left: 0;
    position: fixed;
    top: 0;
    z-index: 50;
    /* Box Model */
    border-radius: 2px;
    height: 4px;
    /* Visual */
    background: var(--progress-bar-bg-gradient);
}

.section-icon {
    /* Positioning */
    align-items: center;
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    /* Box Model */
    border-radius: 12px; 
    height: 50px;
    margin-right: 1rem;
    width: 50px;
    /* Visual */
    background: var(--section-icon-bg-gradient);
}

.floating-nav {
    /* Positioning */
    bottom: var(--padding-lg);
    display: flex;
    position: fixed;
    right: var(--padding-lg);
    z-index: 40;
    /* Box Model */
    gap: var(--padding-sm);
}

.floating-btn {
    /* Positioning */
    align-items: center;
    display: flex;
    justify-content: center;
    /* Box Model */
    border-radius: 50%;
    height: 50px;
    width: 50px;
    /* Typography */
    color: var(--button-text-color);
    font-size: 1.25rem;
    /* Visual */
    background: var(--button-primary-bg-gradient); 
    box-shadow: var(--floating-btn-box-shadow);
    /* Animation & Transitions */
    transition: var(--transition-all-fast);
    /* Misc */
    cursor: pointer;
}

.floating-btn:hover {
    box-shadow: var(--floating-btn-hover-box-shadow);
    transform: translateY(-5px) rotate(5deg);
}

#glossary-modal-backdrop {
    /* Positioning */
    left: 0;
    position: fixed;
    top: 0;
    z-index: 99;
    /* Box Model */
    height: 100%;
    width: 100%;
    /* Visual */
    backdrop-filter: blur(5px);
    background-color: rgba(0, 0, 0, 0.7);
    /* Misc */
    display: none; 
}

#glossary-modal {
    /* Positioning */
    left: 50%;
    position: fixed;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 100;
    /* Box Model */
    border: 1px solid var(--modal-border-color);
    border-radius: var(--border-radius-lg);
    max-width: 500px;
    padding: var(--padding-xl);
    width: 90%;
    /* Visual */
    background: var(--modal-bg-gradient);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
    /* Misc */
    display: none;
}

/* ==================== */
/* Animations & Effects */
/* ==================== */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.animate-shake {
    animation: shake 0.3s ease-in-out;
}

.text-loop-highlight {
    color: #cadcff; 
}
body.light-mode .text-loop-highlight {
    color: #3e64d3;
}

/* ======================== */
/* Utility / Helper Classes */
/* ======================== */
.bg-yellow-800\/50 { 
    background-color: rgba(146, 64, 14, 0.5); 
}
body.light-mode .bg-yellow-800\/50 { background-color: var(--color-amber-inline-code-bg) !important; }


.bg-red-800\/50 {
    background-color: rgba(153, 27, 27, 0.5); 
}
body.light-mode .bg-red-800\/50 { background-color: var(--color-red-light-bg) !important; }

body.light-mode .border-t { border-color: var(--interactive-card-border); }

/* Ensure .border-dark-600 uses our theme variable */
.border-dark-600 {
    border-color: var(--card-border) !important; /* Use theme-aware card border color */
}

/* For light mode, specifically, we might want a slightly different shade if card-border is too subtle or too dark */
body.light-mode .border-dark-600 {
    border-color: var(--secondary-gray-medium) !important; /* Or var(--light-card-border) if preferred */
}


/* ===================================== */
/* Chapter-Specific Styles             */
/* ===================================== */
/* This section overrides specific Tailwind text color classes
   to ensure high contrast and readability in light mode across all chapters,
   aligning with the new color palette. */

/* ----- Generic Text Color Overrides for Light Mode ----- */

/* Main paragraph and list text (e.g., text-slate-300 originally) */
body.light-mode .text-slate-100,
body.light-mode .text-slate-200,
body.light-mode .text-slate-300 { 
    color: var(--text-primary) !important; /* Should be --text-color-main (#212529) */
}

/* Secondary, muted, and subtle text (e.g., text-slate-400 originally) */
body.light-mode .text-slate-400,
body.light-mode .text-slate-500 {
    color: var(--text-muted) !important; /* Should be --secondary-gray-dark (#707070) */
}

/* ----- Primary Accent Colors (Blue/Purple) ----- */
/* These are often used for links or highlighted text within paragraphs. */
body.light-mode .text-primary-200,
body.light-mode .text-primary-300,
body.light-mode .text-primary-400,
body.light-mode .text-primary-500,
body.light-mode .text-blue-200,
body.light-mode .text-blue-300,
body.light-mode .text-blue-400 {
    color: var(--accent-blue-cta) !important; /* Using the CTA blue for general blue text highlights */
}

body.light-mode .text-purple-300,
body.light-mode .text-purple-400,
body.light-mode .text-accent-500 {
    color: var(--light-code-function) !important; /* Using the darker purple from code variables */
}


/* ----- Other Accent Colors (Amber, Green, Red) ----- */
/* These are often used for semantic highlighting. */
body.light-mode .text-amber-200,
body.light-mode .text-amber-300,
body.light-mode .text-amber-400 {
    color: var(--light-code-placeholder) !important; /* Using the darker amber from code variables */
}

body.light-mode .text-green-400,
body.light-mode .text-lime-400 {
    color: var(--light-code-string) !important; /* Using the darker green from code variables */
}

body.light-mode .text-red-200,
body.light-mode .text-red-300,
body.light-mode .text-red-400 {
    color: var(--color-red-darker) !important; /* Using the theme-agnostic darker red */
}

/* ----- Special Highlight Classes ----- */

body.light-mode .text-loop-highlight { /* This was a specific highlight, ensure it's distinct */
    color: var(--accent-blue-highlight) !important; /* Using a slightly different blue if needed, or CTA */
}

body.light-mode #c-conditionals code.bg-amber-900 { 
    background-color: var(--color-amber-inline-code-bg);
    border: 1px solid var(--color-amber-light-border);
    color: var(--color-amber-inline-code-text);
    font-weight: 600;
}

body.light-mode #c-conditionals #decision-output .text-green-400 { 
    color: var(--color-green-decision); 
    font-weight: 600; 
}

body.light-mode #c-conditionals #decision-output .text-red-400 { 
    color: var(--color-red-darker); 
    font-weight: 600; 
}

/* ----- Table styles for light mode ----- */
body.light-mode table { 
    border-color: var(--interactive-card-border); 
}
body.light-mode th,
body.light-mode td {
    border-color: var(--light-modal-bg-end);
    color: var(--text-primary);
}

/* ==================== */
/* Responsive Design    */
/* ==================== */
@media (max-width: 768px) {
    .content-card {
        padding: var(--padding-md);
    }
    
    .section-header { 
        align-items: flex-start;
        flex-direction: column;
    }
    
    .section-icon {
        margin-bottom: 1rem; 
    }
}

/* ================================== */
/* Light Mode Contrast Patch v2.0    */
/* ================================== */
/* Force-overriding specific faint Tailwind classes in light mode */

body.light-mode .text-slate-300 {
    color: #1e293b; /* Using a much darker color (like slate-800) for main paragraphs */
}

body.light-mode .text-slate-400 {
    color: #475569; /* Using a darker color (like slate-600) for secondary text */
}

/* ================================== */
/* Light Mode Icon Background Fix    */
/* ================================== */
/* Overriding faint icon background colors for light mode */

body.light-mode .bg-primary-500 {
    background-color: var(--color-blue-darker) !important; /* Force a dark blue */
}

body.light-mode .bg-accent-500 {
    background-color: var(--color-purple-darker) !important; /* Force a dark purple */
}

body.light-mode .bg-green-500 {
    background-color: var(--color-green-darker) !important; /* Force a dark green for other icons */
}